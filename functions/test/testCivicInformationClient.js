'use strict'

var expect = require('chai').expect;
var civicInfoClient = require('../civicinformationclient');

const json = JSON.parse(`{ "kind": "civicinfo#representativeInfoResponse", "normalizedInput": {  "line1": "459 Madison Street",  "city": "Seattle",  "state": "WA",  "zip": "98104" }, "divisions": {  "ocd-division/country:us": {   "name": "United States",   "officeIndices": [    0,    1   ]  },  "ocd-division/country:us/state:wa": {   "name": "Washington",   "officeIndices": [    2,    4,    5,    16,    17,    18,    19,    20,    21,    22   ]  },  "ocd-division/country:us/state:wa/cd:7": {   "name": "Washington's 7th congressional district",   "officeIndices": [    3   ]  },  "ocd-division/country:us/state:wa/county:king": {   "name": "King County",   "officeIndices": [    6,    7,    8,    9,    10,    11   ]  },  "ocd-division/country:us/state:wa/place:seattle": {   "name": "Seattle city",   "officeIndices": [    12,    13,    14,    15   ]  } }, "offices": [  {   "name": "President of the United States",   "divisionId": "ocd-division/country:us",   "levels": [    "country"   ],   "roles": [    "headOfState",    "headOfGovernment"   ],   "officialIndices": [    0   ]  },  {   "name": "Vice-President of the United States",   "divisionId": "ocd-division/country:us",   "levels": [    "country"   ],   "roles": [    "deputyHeadOfGovernment"   ],   "officialIndices": [    1   ]  },  {   "name": "United States Senate",   "divisionId": "ocd-division/country:us/state:wa",   "levels": [    "country"   ],   "roles": [    "legislatorUpperBody"   ],   "officialIndices": [    2,    3   ]  },  {   "name": "United States House of Representatives WA-07",   "divisionId": "ocd-division/country:us/state:wa/cd:7",   "levels": [    "country"   ],   "roles": [    "legislatorLowerBody"   ],   "officialIndices": [    4   ]  },  {   "name": "Governor",   "divisionId": "ocd-division/country:us/state:wa",   "levels": [    "administrativeArea1"   ],   "roles": [    "headOfGovernment"   ],   "officialIndices": [    5   ]  },  {   "name": "Lieutenant Governor",   "divisionId": "ocd-division/country:us/state:wa",   "levels": [    "administrativeArea1"   ],   "roles": [    "deputyHeadOfGovernment"   ],   "officialIndices": [    6   ]  },  {   "name": "Sheriff",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    7   ]  },  {   "name": "Assessor",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    8   ]  },  {   "name": "County Executive",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    9   ]  },  {   "name": "Elections Director",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    10   ]  },  {   "name": "Prosecuting Attorney",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    11   ]  },  {   "name": "King County Superior Court Judge",   "divisionId": "ocd-division/country:us/state:wa/county:king",   "officialIndices": [    12   ]  },  {   "name": "Mayor",   "divisionId": "ocd-division/country:us/state:wa/place:seattle",   "officialIndices": [    13   ]  },  {   "name": "Attorney",   "divisionId": "ocd-division/country:us/state:wa/place:seattle",   "officialIndices": [    14   ]  },  {   "name": "Council, Position 8",   "divisionId": "ocd-division/country:us/state:wa/place:seattle",   "officialIndices": [    15   ]  },  {   "name": "Council, Position 9",   "divisionId": "ocd-division/country:us/state:wa/place:seattle",   "officialIndices": [    16   ]  },  {   "name": "State Auditor",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    17   ]  },  {   "name": "State Treasurer",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    18   ]  },  {   "name": "Attorney General",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    19   ]  },  {   "name": "Secretary of State",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    20   ]  },  {   "name": "Insurance Commissioner",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    21   ]  },  {   "name": "Commissioner of Public Lands",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    22   ]  },  {   "name": "State Superintendent of Public Instruction",   "divisionId": "ocd-division/country:us/state:wa",   "officialIndices": [    23   ]  } ], "officials": [  {   "name": "Donald J. Trump",   "address": [    {     "line1": "The White House",     "line2": "1600 Pennsylvania Avenue NW",     "city": "Washington",     "state": "DC",     "zip": "20500"    }   ],   "party": "Republican",   "phones": [    "(202) 456-1111"   ],   "urls": [    "http://www.whitehouse.gov/"   ],   "photoUrl": "https://www.whitehouse.gov/sites/whitehouse.gov/files/images/45/PE%20Color.jpg",   "channels": [    {     "type": "GooglePlus",     "id": "+whitehouse"    },    {     "type": "Facebook",     "id": "whitehouse"    },    {     "type": "Twitter",     "id": "potus"    },    {     "type": "YouTube",     "id": "whitehouse"    }   ]  },  {   "name": "Mike Pence",   "address": [    {     "line1": "The White House",     "line2": "1600 Pennsylvania Avenue NW",     "city": "Washington",     "state": "DC",     "zip": "20500"    }   ],   "party": "Republican",   "phones": [    "(202) 456-1111"   ],   "urls": [    "http://www.whitehouse.gov/"   ],   "photoUrl": "https://www.whitehouse.gov/sites/whitehouse.gov/files/images/45/VPE%20Color.jpg",   "channels": [    {     "type": "GooglePlus",     "id": "+whitehouse"    },    {     "type": "Facebook",     "id": "whitehouse"    },    {     "type": "Twitter",     "id": "VP"    }   ]  },  {   "name": "Maria Cantwell",   "address": [    {     "line1": "511 Hart Senate Office Building",     "city": "Washington",     "state": "DC",     "zip": "20510"    }   ],   "party": "Democratic",   "phones": [    "(202) 224-3441"   ],   "urls": [    "https://www.cantwell.senate.gov/"   ],   "photoUrl": "http://bioguide.congress.gov/bioguide/photo/C/C000127.jpg",   "channels": [    {     "type": "Twitter",     "id": "senatorcantwell"    },    {     "type": "YouTube",     "id": "SenatorCantwell"    }   ]  },  {   "name": "Patty Murray",   "address": [    {     "line1": "154 Russell Senate Office Building",     "city": "Washington",     "state": "DC",     "zip": "20510"    }   ],   "party": "Democratic",   "phones": [    "(202) 224-2621"   ],   "urls": [    "http://www.murray.senate.gov/public/"   ],   "photoUrl": "http://bioguide.congress.gov/bioguide/photo/M/M001111.jpg",   "channels": [    {     "type": "GooglePlus",     "id": "+pattymurray"    },    {     "type": "Twitter",     "id": "pattymurray"    },    {     "type": "YouTube",     "id": "SenatorPattyMurray"    },    {     "type": "Facebook",     "id": "pattymurray"    },    {     "type": "YouTube",     "id": "pattymurray"    }   ]  },  {   "name": "Pramila Jayapal",   "address": [    {     "line1": "319 Cannon House Office Building",     "city": "Washington",     "state": "DC",     "zip": "20515"    }   ],   "party": "Democratic",   "phones": [    "(202) 225-3106"   ],   "urls": [    "https://jayapal.house.gov/"   ],   "photoUrl": "https://jayapal.house.gov/sites/jayapal.house.gov/files/wysiwyg_uploaded/Official%20Photo_2017.03.10%20-%20Copy.jpg",   "channels": [    {     "type": "Twitter",     "id": "RepJayapal"    },    {     "type": "YouTube",     "id": "UCMnbmouxS9x95erN4NlBjDw"    },    {     "type": "YouTube",     "id": "UCmyD0_-2Oowkfwc_Raghclw"    }   ]  },  {   "name": "Jay Inslee",   "address": [    {     "line1": "PO Box 40002",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Democratic",   "phones": [    "(360) 902-4111"   ],   "urls": [    "http://www.governor.wa.gov/"   ],   "photoUrl": "http://www.governor.wa.gov/sites/default/files/images/720px-for-web_0.jpg",   "emails": [    "Governor.JayInslee@governor.wa.gov"   ],   "channels": [    {     "type": "Facebook",     "id": "WaStateGov"    },    {     "type": "Twitter",     "id": "GovInslee"    },    {     "type": "YouTube",     "id": "UCJhWBqWVdVnPro7tx2t7j3w"    }   ]  },  {   "name": "Cyrus Habib",   "address": [    {     "line1": "PO Box 40400",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Democratic",   "phones": [    "(360) 786-7700"   ],   "urls": [    "http://www.ltgov.wa.gov/"   ],   "photoUrl": "http://www.ltgov.wa.gov/wp-content/uploads/2017/01/Senator-Habib-2015_CROPPED-225x300.jpg",   "emails": [    "ltgov@ltgov.wa.gov"   ],   "channels": [    {     "type": "Twitter",     "id": "waltgov"    }   ]  },  {   "name": "Mitzi Johanknecht",   "address": [    {     "line1": "516 Third Ave Room W-116",     "city": "Seattle",     "state": "WA",     "zip": "98104"    }   ],   "phones": [    "(206) 296-4155"   ],   "urls": [    "http://www.kingcounty.gov/depts/sheriff/about-us/biographies.aspx"   ],   "emails": [    "sheriff@kingcounty.gov"   ],   "channels": [    {     "type": "Facebook",     "id": "KingCountySheriff"    }   ]  },  {   "name": "John Wilson",   "address": [    {     "line1": "500 Fourth Ave ADM-AS-0708",     "city": "Seattle",     "state": "WA",     "zip": "98104"    }   ],   "party": "Unknown",   "phones": [    "(206) 296-7300"   ],   "urls": [    "http://www.kingcounty.gov/depts/assessor/About-Us/Assessors-Bio.aspx"   ]  },  {   "name": "Dow Constantine",   "address": [    {     "line1": "401 5th Ave Suite 800",     "city": "Seattle",     "state": "WA",     "zip": "98104"    }   ],   "phones": [    "(206) 263-9600"   ],   "urls": [    "http://www.kingcounty.gov/elected/executive/constantine/about/biography.aspx"   ],   "photoUrl": "http://www.kingcounty.gov/~/media/elected/portal/elected-exec-lg.ashx?la=en",   "emails": [    "kcexec@kingcounty.gov"   ],   "channels": [    {     "type": "Twitter",     "id": "kcnews"    },    {     "type": "Facebook",     "id": "ExecutiveConstantine"    }   ]  },  {   "name": "Julie Wise",   "address": [    {     "line1": "919 SW Grady Way,",     "city": "Renton",     "state": "WA",     "zip": "98057"    }   ],   "party": "Unknown",   "phones": [    "(206) 477-4140"   ],   "urls": [    "http://www.kingcounty.gov/depts/elections/about-us/meet-the-director.aspx"   ],   "emails": [    "elections@kingcounty.gov"   ],   "channels": [    {     "type": "Facebook",     "id": "KingCountyElections"    },    {     "type": "Twitter",     "id": "kcelections"    }   ]  },  {   "name": "Dan Satterberg",   "address": [    {     "line1": "516 Third Ave W400",     "city": "Seattle",     "state": "WA",     "zip": "98104"    }   ],   "party": "Unknown",   "phones": [    "(206) 477-1200"   ],   "urls": [    "http://www.kingcounty.gov/depts/prosecutor/bio.aspx"   ],   "emails": [    "Prosecuting.Attorney@kingcounty.gov"   ],   "channels": [    {     "type": "Twitter",     "id": "KCProsecutor"    }   ]  },  {   "name": "Catherine Moore",   "address": [    {     "line1": "516 3rd Ave Room C-203",     "city": "Seattle",     "state": "WA",     "zip": "98104"    }   ],   "party": "Unknown",   "phones": [    "(206) 477-1591"   ],   "urls": [    "http://www.kingcounty.gov/courts/superior-court/directory/judges.aspx"   ],   "emails": [    "moore.court@kingcounty.gov"   ]  },  {   "name": "Jenny Durkan",   "address": [    {     "line1": "600 4th Ave",     "city": "Seattle",     "state": "WA",     "zip": ""    }   ],   "party": "Democratic",   "phones": [    "(206) 684-4000"   ],   "urls": [    "http://www.seattle.gov/mayor/"   ]  },  {   "name": "Pete Holmes",   "address": [    {     "line1": "PO Box 94769",     "city": "Seattle",     "state": "WA",     "zip": "98124"    }   ],   "phones": [    "(206) 684-8200"   ],   "urls": [    "http://www.seattle.gov/law/"   ],   "channels": [    {     "type": "Facebook",     "id": "205227219570476"    }   ]  },  {   "name": "Teresa Mosqueda",   "address": [    {     "line1": "PO Box 34025",     "city": "Seattle",     "state": "WA",     "zip": "98124"    }   ],   "phones": [    "(206) 684-8806"   ],   "urls": [    "http://www.seattle.gov/council/meet-the-council#mosqueda"   ],   "emails": [    "teresa.mosqueda@seattle.gov"   ]  },  {   "name": "Lorena Gonzalez",   "address": [    {     "line1": "PO Box 34025",     "city": "Seattle",     "state": "WA",     "zip": "98124"    }   ],   "phones": [    "(206) 684-8802"   ],   "urls": [    "http://www.seattle.gov/council/meet-the-council/lorena-gonz%C3%A1lez"   ],   "photoUrl": "http://www.seattle.gov/Images/Council/Members/Gonzalez/gonzalez_thumb.jpg",   "emails": [    "Lorena.Gonzalez@seattle.gov"   ],   "channels": [    {     "type": "Twitter",     "id": "CMLGonzalez"    }   ]  },  {   "name": "Pat (Patrice) McCarthy",   "address": [    {     "line1": "Insurance Building Capitol Campus",     "line2": "302 Sid Snyder Avenue SW",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Democratic",   "phones": [    "(360) 902-0370"   ]  },  {   "name": "Duane Davidson",   "address": [    {     "line1": "PO Box 40200",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Republican",   "phones": [    "(360) 902-9001"   ]  },  {   "name": "Bob Ferguson",   "address": [    {     "line1": "PO Box 40100",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Democratic",   "phones": [    "(360) 753-6200"   ],   "urls": [    "http://www.atg.wa.gov/"   ],   "channels": [    {     "type": "Facebook",     "id": "WAStateAttorneyGeneral"    },    {     "type": "Twitter",     "id": "AGOWA"    }   ]  },  {   "name": "Kim Wyman",   "address": [    {     "line1": "PO Box 40220",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Republican",   "phones": [    "(360) 902-4151"   ],   "urls": [    "http://www.sos.wa.gov/"   ],   "emails": [    "kim.wyman@sos.wa.gov"   ],   "channels": [    {     "type": "Facebook",     "id": "WaSecretaryOfState"    },    {     "type": "Twitter",     "id": "secstatewa"    }   ]  },  {   "name": "Mike Kreidler",   "party": "Democratic",   "phones": [    "(360) 725-7000"   ],   "urls": [    "http://www.insurance.wa.gov/"   ],   "channels": [    {     "type": "Facebook",     "id": "wsoic"    },    {     "type": "Twitter",     "id": "WAinsuranceblog"    }   ]  },  {   "name": "Hilary Franz",   "address": [    {     "line1": "PO Box 47000",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Democratic",   "phones": [    "(360) 902-1000"   ]  },  {   "name": "Chris Reykdal",   "address": [    {     "line1": "Mail stop: 47200 Old Capitol Building P.O. Box 47200",     "city": "Olympia",     "state": "WA",     "zip": "98504"    }   ],   "party": "Nonpartisan",   "phones": [    "(360) 725-6115"   ]  } ]}`);

const errorJSON = JSON.parse(`{ "error": {  "errors": [   {    "domain": "global",    "reason": "parseError",    "message": "Failed to parse address"   }  ],  "code": 400,  "message": "Failed to parse address" }}`);

describe('getOffices()', () => {
  it('should get a map with keys of available recognized offices', () => {
    const offices = civicInfoClient.getOffices(json);
    const keys = ["Senator", "House Rep", "Governor", "Sheriff", "Mayor", "Councillor", "Attorney General"];
    expect(Object.keys(offices)).to.eql(keys);
  });
  it('should get a map of offices to appropriate reps', () => {
    const offices = civicInfoClient.getOffices(json);
    expect(offices['Senator'][1].name).to.eql('Patty Murray');
  });
  it('should throw error for malformed JSON', () => {
    expect(civicInfoClient.getOffices.bind(errorJSON)).to.throw('Malformed JSON');
  })
});

describe('repFromRaw()', () => {
  it('should generate a valid contact string (smoketest)', () => {
    const rawRep = json.officials[15];
    const rep = civicInfoClient.repFromRaw('officeName', rawRep);
    expect(rep.contactString).to.be.equal('You can email them at teresa.mosqueda@seattle.gov. You can call them at (206) 684-8806.');
  });
});

describe('getRawRepsWithOffice()', () => {
  it('should generate a list of all reps', () => {
    expect(civicInfoClient.getRawRepsWithOffice(json).length).to.be.equal(24);
  });
  it('should include expected office names', () => {
    expect(civicInfoClient.getRawRepsWithOffice(json)[5].officeName).to.be.equal('Governor');
    expect(civicInfoClient.getRawRepsWithOffice(json)[5].name).to.be.equal('Jay Inslee');
    expect(civicInfoClient.getRawRepsWithOffice(json)[5].firstName).to.be.equal('Jay');
  });
});
